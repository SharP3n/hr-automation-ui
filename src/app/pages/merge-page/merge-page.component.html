<app-actions-bar-merge></app-actions-bar-merge>
<mat-progress-bar
  mode="indeterminate"
  color="primary"
  *ngIf="mergeService.pageState.loading"
></mat-progress-bar>
<ng-container *ngIf="!mergeService.pageState.loading">
  <div *ngIf="isCandidates();else noCandidatesId" class="candidate-merge-container">
    <div class="desc-titles-container">
      <div class="desc-title"></div>
      <ng-container *ngFor="let title of mergeService.attributesTitles">
        <div class="desc-title">{{title}}</div>
      </ng-container>
    </div>

    <div class="candidates-container">
      <div *ngFor="let candidateId of candidateIds | async; let indexMatrix=index" class="desc-candidate-container">
        <label class="desc-candidate-title">
          <mat-checkbox 
            color="primary"
            aria-label="desc-candidate-title" 
            [value]="indexMatrix.toString()"
            [checked]="isAllCandidateAttributesChoose(indexMatrix)"
            (change)="chooseAllCandidateAttributes($event)"
            >
            {{candidateId}}
          </mat-checkbox>
          <mat-icon color="warn" (click)="removeCandidateById(candidateId)" class="remove-button">delete_forever</mat-icon>
        </label>
       <ng-container *ngFor="let attribute of mergeService.attributesMatrix[indexMatrix]; let indexCandidate=index">
          <app-candidate-merge 
            [checked]="!!mergeService.finalAttributesMatrix[indexMatrix][indexCandidate]"
            [candidateAttr] = "attribute" 
            [candidatesMatrixIndexes] = "[indexMatrix, indexCandidate]"
            (changeAttributes)="changeAttributes($event)"
            class="desc-candidate">
          </app-candidate-merge>
        </ng-container>          
      </div>        
    </div>

    <div class="desc-result-container">
      <div class="desc-result-title" [ngClass]="{'filled-result': checkFilledResult()}">Result</div>
      <ng-container *ngFor="let result of finalResult | async">
        <div class="desc-result" [ngClass]="{'final-result': result.join(', ')}">
          {{result.join(', ')}}
      </div>
      </ng-container>
    </div>
  </div>

</ng-container>

<ng-template #noCandidatesId>  
  <p class="nothing-merge">You have not selected candidates for the merge. Please add more candidates.</p>  
</ng-template>  
